# 第三章内存管理
**内存**=**系统区**+**内存区**


## 基本分页存储管理
基本分页存储管理的思想：**把进程分页，各个页面可离散地放到各个内存块中**
基本概念
页框=内存块=页帧=物理块=物理页：内存中的块
页/页面：逻辑上的块，但是其大小与页框相等。

### 基本地址变换机构
页表寄存器（PTR）：存放页表在内存中的起始地址F和页表长度M,**进程未执行时会放在进程控制块（PCB）中**，进程被调度时，操作系统内核会把它们放到页表寄存器中
> 地址变换过程：
> 1. 根据逻辑地址算出页号，页内偏移量
> 2. 检查页号是否越界
> 3. 若页号合法则根据页表起始地址和页号找到对应页表项（==第一次访问内存—查页表==）
> 4. 根据页表项的内存块号、页内偏移量得到最终物理地址
> 5. 访问物理地址对应的物理单元（==第二次访问内存—访问目标单元==）

注：**页式管理**是**一维**的

 快表：又称联想寄存器（TLB），是一种访问速度比内存快很多的**高速缓存**，用来存放**最近频繁访问的页表项的副本**。
 
寄存器=>高速缓存(Cache)=>内存（RAM）=>外存

引入快表后**地址变换**的**不同**：
快表**命中**，则只需要**一次访存**
快表**未命中**，则仍需要**两次访存**（==第一次==访存查找==页表项==时，会同时==复制到快表==）

#### 局部性原理
**时间局部性**：若执行了程序中的某条指令，那么==不久后==这条指令==很可能==再次被==执行==。
**空间局部性**：一旦程序访问了某个存储单元，则==不久后附近的存储单元==也==很可能被访问==


TLB（快表）与Cache的区别：

|存储器件|TLB|Cache|
|----|----|----|
|区别|只有页表项的副本|可能还有其他各种数据的副本|

### 两级页表
#### 单级页表的问题
1. 页表必须连续存放，因此当页表很大时，需要占用很多连续的页框
2. 没必要让整个页表常驻内存，因为进程在一段时间内可能只需要访问某几个特定的页面

一号页表（页目录表）->二号页表->页内偏移量

注意细节：
1. 多级页表机制下，**各级页表的大小不能超过一个页面**
2. 两级页表的访存次数为3次：
> - 第一次访存：页目录表
> - 第二次访存：二级页表
> - 第三次访存：访问目标内存单元
N级页表访问逻辑地址需要N+1次访存（无快表情况）

## 基本分段存储管理

分段：按照程序**自身逻辑**关系**划分为若干个段**，每个段都有段名，**每段从0开始编址**，每个段在内存中占据连续空间，各段之间可以不相邻

1. 段号的位数决定了每个进程最多可以分几个段
2. 段内地址位数决定了每个段的最大长度是多少

段表：由段号、段长、基址三部分组成
段表项长度相同
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTIwNTI5NTE1NTgsLTE1NzcyMjk0MTcsMT
AwMTA3NzIxOCw4NzYxNDc5NzAsNjYzMDkwODY4LDE1NTczNTUz
OTQsLTEyNzI2MjM1NDAsMTU0Mjc2MzMyNiwyMDQ3MDg4OTAyXX
0=
-->